---
title: "EDA Notebook Analysis"
output: html_document
date: "2025-07-17"
Author: Yumeng Tan, Sherelle Li, Rom Zuckerman
---
### Heart Attack Exploratory Data Analysis

**Team Members**: Yumeng Tan, Sherelle Li, Rom Zuckerman

### I. INTRODUCTION

#### 1) Introducing the Dataset

  For this project, we work with data from the **2015 Behavioral Risk Factor Surveillance System (BRFSS)**—a nationwide health survey run each year by the **Centers for Disease Control and Prevention (CDC)** in partnership with U.S. states and territories. The survey is conducted through telephone interviews, both land-line and cellular, reaching adults aged 18 and older living in community settings.  

  The BRFSS was designed to track health-related risk behaviors, chronic conditions, and use of preventive care across the U.S. In 2015, it collected information from 441,456 individuals, and the result spanned over all 50 states, the District of Columbia, Puerto Rico, and Guam. Having a large and representative sample sizes, the dataset give us a rich and reliable snapshot of health behaviors nationwide. The dataset also include 330 columns, which allows us to have a wide range of variables to explore and test on. 
  
  Beside having a large sample sizes, **2015 BRFSS** dataset also have other practical and methodological reasons that matter for our exploration. Firstly, the dataset is weighted so its findings reflect state-level populations—making it a trusted source for public health planning, policy-making, and resource allocation. Secondly, more recent datasets have **gaps in state coverage** -- for example, the 2023 survey omits large states such as Pennsylvania and Kentucky—which could make national estimates less reliable. Thus, compare to other dataset, **2015 BRFSS** dataset provides a more representative and comprehensive insight into the U.S populations, providing a reliable data for research purposes. 
<br><br>

#### 2) Research Interest

  The original dataset has 330 columns, making it hard to track specific variables that we are going to use in this research. Thus, we subset the dataset by only selecting variables related to the research in our final dataset. 
  
  Our main outcome of interest is **heart attack** (`CVDINFR4`). This choice is deliberate: heart attacks are urgent, affecting 17.9 millions of lives each year. Thus, it demands immediate medical attention ([NIH](https://www.nhlbi.nih.gov/health/heart-attack)). However, heart attacks can occur even without a prior coronary heart disease diagnosis ([ClevelandClinic](https://my.clevelandclinic.org/health/diseases/16818-heart-attack-myocardial-infarction)). As a result, identifying predictors is necessary for preventing heart attack, and it is our main goal of this study.
  
  Based on preliminary research, **Body Mass Index (BMI)** is potentially related to heart attack. According to studies, extra fat increases inflammation, insulin resistance, and arterial damage discussing groups that may be more vulnerable or underrepresented ([NIH](https://pmc.ncbi.nlm.nih.gov/articles/PMC8449192/). Moreover, BMI is the primary diagnosing index for obesity, a disease that has impacts 41.9% of U.S. adults ([CDC](https://www.cdc.gov/obesity/adult-obesity-facts/index.html)). Given the wide impacts of obesity on U.S adults, exploring correlation between BMI and heart attack risks can have significant implication to a wide range of U.S populations. As a result, we use **Body Mass Index (BMI)** as the main predictor for heart attack risks in this study.
  
  While BMI is a potential predictor of heart attack, its relationship with heart attack risks may be modulated and confounded by other demographic variables. Thus, in this study, we also explore the interaction between four demographic factors and BMI, and we controlled these covariates by including them in the model. The demographic variables include: **Sex**, **Race**, **Age**, and **Income**. 
  
  After reviewing established research on cardiovascular disease risk factors, we identified **Body Mass Index** as our main predictor, and we include **Sex**, **Race**, **Age**, and **Income** as covariates in the model. We subset our original 2015 BRFSS dataset, and we only include these variables in our final dataset. With that in mind, let’s look at the specific variables that will guide our exploration.  

- **CVDINFR4**: Whether the respondent has ever been told they had a heart attack (myocardial infarction).  
  - 1 = Yes - 2 = No - 7 = Don’t know - 9 = Refused  

- **SEX**: Biological sex of the respondent.  
  - 1 = Male - 2 = Female  

- **INCOME2**: Annual household income from all sources, in categorical brackets.  
  - 1–8 = Ranges from < $10,000 to ≥ $75,000 - 77 = Don’t know - 99 = Refused  

- **X_RACEGR3**: Race group (recoded into 3 categories).  
  - 1 = White only - 2 = Black only - 3 = Other or multiracial  

- **X_AGEG5YR**: Age group in 5-year intervals.  
  - 1 = 18–24 - 2 = 25–29 - ... - 13 = 80+  

- **X_BMI5**: Body Mass Index (BMI), calculated as BMI × 100.  
  - Continuous variable: Divide by 100 to get actual BMI  

- **X_BMI5CAT**: BMI category based on X_BMI5.  
  - 1 = Underweight - 2 = Normal weight - 3 = Overweight - 4 = Obese  

  Taken together, these variables give us a comprehensive prediction on heart attack risks. The next step in our exploration will be preparing and transforming the data so we can uncover these relationships in a clear, systematic way.
<br><br>

### II. Dataset Manipulation

#### 1) Loading dataset and packages

1. **Install and load packages**: We set up the environment and install the packages necessary for our data analysis below. We in the code below, we load all the installed packages to make the functions within them available to use in our script.

```{r}
# Load libraries
library(ggplot2)
library(car)
library(carData)
library(ResourceSelection)
library(pROC)
library(dplyr)
library(emmeans)
library(ggeffects)
```
<br><br>

2. **Loading Dataset**: We first load our original dataset **2015.csv** into R Studio. The dataset is directly downloaded from CDC website and hasn't been cleaned yet. 

```{r}
#Load original dataset
df <- read.csv("~/Documents/GitHub/EDA_Project/data/2015.csv")
```

3. **Selecting relevant variables**: The original dataset has 330 variables. To have a more effective and condense dataset, we only select variables that will be used for future analysis into a new dataset **df1**. These include response variable -- heart attack(`CVDINFR4`), and predictors -- sex(`SEX`), income level(`INCOME2`), race(`X_RACEGR3`), age(`X_AGE80` for numeric; `X_AGEG5YR` for categorical), and BMI(`X_BMI5` for numeric; `X_BMI5CAT` for categorical)

```{r}
#Select relevant predictors and dependent variable
df1 <- df[, c("CVDINFR4", "SEX", "INCOME2", "X_RACEGR3", "X_AGEG5YR", "X_AGE80", "X_BMI5",
              "X_BMI5CAT")]
```
<br><br>

#### 2) Factoring and Renaming Variables 

After selecting response variable and main predictors, we factor variables, rename variables, and detect NA in the dataset. 

  **Factor variables**: In the original dataset, all variables are coded as numbers, including categorical values. Thus, we first factor all the predictors by changing numbers into their corresponding categorical labels. We do this by using factor() functions.
  
  **Rename variables**: We also rename variables by storing factored variables into a clearer name.
  
  **Detect NA**: For NA values, they are encoded as specific numbers for each predictor. The specific values representing NA are written in the 2015 codebook report on CDC website. For example, for response variable heart attack, "7" represents "Don't know", and "9" represents "Refused". We look up for numbers that represent NA for each variable, and we recode these numbers into "NA" using factor() functions.

```{r}
# Recode CVDINFR4
df1$CVDINFR4[df1$CVDINFR4 %in% c(7, 9)] <- NA
df1$HeartAttack <- ifelse(df1$CVDINFR4 == 1, 1,
                          ifelse(df1$CVDINFR4 == 2, 0, NA))
df1$HeartAttack <- factor(df1$HeartAttack, levels = c(0, 1), labels = c("No", "Yes"))

# Recode SEX
df1$SEX <- factor(df1$SEX, levels = c(1, 2), labels = c("Male", "Female"))

# Recode INCOME2
df1$INCOME2[df1$INCOME2 %in% c(77, 99)] <- NA
df1$INCOME <- factor(df1$INCOME2, levels = c(1:8),
                      labels = c("<$10k", "$10-15k", "$15-20k", "$20-25k", "$25-35k",
                                 "$35-50k", "$50-75k", ">=75k"))

# Recode _RACEGR3 as factor with appropriate labels
df1$`X_RACEGR3`[df1$`X_RACEGR3` == 9] <- NA
df1$RACE <- factor(df1$`X_RACEGR3`,
                         levels = c(1:5),
                         labels = c("White", "Black", "Other",
                                    "Multiracial", "Hispanic"))

# Recode _AGEG5YR
df1$AGE <- factor(df1$`X_AGEG5YR`, levels = 1:13,
                         labels = c("18–24", "25–29", "30–34", "35–39", "40–44", "45–49",
                                    "50–54", "55–59", "60–64", "65–69", "70–74", "75–79", "80+"))

# Recode _AGE80 
names(df1)[names(df1) == "X_AGE80"] <- "AGE_Num"

# Recode _BMI5 
df1$`X_BMI5`[df1$`X_BMI5` == 9999] <- NA
names(df1)[names(df1) == "X_BMI5"] <- "BMI_Num"

# Recode _BMI5CAT
df1$BMI_Cat <- factor(df1$`X_BMI5CAT`, levels = 1:4,
                         labels = c("Underweight", "Normal", "Overweight", "Obese"))
```

<br><br>

#### 3) Handling Missing Values

**Filtering out rows with N/A**: In the last step of our dataset cleaning, we must ensure that our cleaned dataset doesn't have missing values in it. So we remove any rows within the dataset that have missing values using na.omit() functions. We also store the dataset into a new dataset called **df_clean**. We then export the dataset into a CSV file for future use using write.csv() functions.

```{r}
# Remove rows with any NA values
df_clean <- na.omit(df1)  

#save cleaned files into csv
write.csv(df_clean, "~/Documents/GitHub/EDA_Project/data/cleaned_data.csv", row.names = FALSE)
```

<br><br>

### III. Data Visualization and Tendency Measurement

#### 1) Frequency Distribution of Heart Attack and Predictors

**Visualization**: In this section, we visualize the distribution of response variable **HeartAttack** and 5 predictors. We also measure the central tendency using mode, median, or mean depending on whether the variable is categorical, nominal, and numeric.

**Define Mode Functions for central tendency measurement**: We create the function get_mode(), a function we will later use for the central tendency measurement. Get_mode() takes in a vector form, which it then uses to create a table, tbl, of that vector, ultimately finding the value with the highest frequency in that table. For example, if a vector of [1,4,5,5] is imputed, we create a 2x2 table of the values, and find that 5 is the value with the highest frequency (as it is found twice in the array)

```{r}
df_clean <- read.csv("~/Documents/GitHub/EDA_Project/data/cleaned_data.csv")
df_clean$BMI_Num <- df_clean$BMI_Num / 100
```

```{r}
# Function to calculate mode
get_mode <- function(v) {
  tbl <- table(v)
  mode_val <- names(tbl)[which.max(tbl)]
  return(mode_val)
}
```

<br><br>

**(a)** Response Variable -- HeartAttack

```{r}
#table
table(df_clean$HeartAttack)
prop.table(table(df_clean$HeartAttack))

#Bar graph
ggplot(df_clean, aes(x = HeartAttack)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of HeartAttack Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Head_Attack\n")
cat("Mode:", get_mode(df_clean$HeartAttack), "\n\n")
```

**Conclusion**: Based on the mode calculation, No is dominantly observed over Yes, meaning more people who filled out the questionnaire doesn’t have heart attack. However, there is still a sufficient amount of observations having heart attack, with an occurrence of 18,674, which is about 5.85% of the total sample size.
<br><br>

**(b)** Predictor -- BMI

We continue to plot and graph the distributions of these different predictors, but instead of simply calculataing mode and median, we add a calculation for mean of BMI, using a function from one of the libraries we installed and initialized earlier in the function - mean().

```{r}
#Bar graph
ggplot(df_clean, aes(x = BMI_Num)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of BMI Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode and Median and Mean
cat("BMI_Num\n")
cat("Mode:", get_mode(df_clean$BMI_Num), "\n")
cat("Median:", median(df_clean$BMI_Num, na.rm = TRUE), "\n")
cat("Mean:", mean(df_clean$BMI_Num, na.rm = TRUE), "\n\n")
```

**Conclusion**: We find that this distribution is skewed to the right, with a large tail that stretches towards the higher BMI values. This means that we have a very comprehensive distribution for the lower BMI values, but due to the large tail and few values at the higher end of range, our statistics such as mean (2820.969) and median (2712) are being skewed to the right. 
<br><br>

**(c)** Predictor -- Sex

```{r}
#table
table(df_clean$SEX)
prop.table(table(df_clean$SEX))

#Bar graph
ggplot(df_clean, aes(x = SEX)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Sex Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Sex\n")
cat("Mode:", get_mode(df_clean$SEX), "\n\n")
```

**Conclusion**:  Based on the mode calculation, female is dominantly observed over male (54.99% vs. 45.01%). This is something notable to consider when looking at other results from distributions and linear regression, as the subject's sex isn't evenly distributed, rather leaning more towards a higher count of female participants than of the male sex.
<br><br>

**(d)** Predictor -- Income

```{r}
#table
table(df_clean$INCOME)
prop.table(table(df_clean$INCOME))

#Bar graph
ggplot(df_clean, aes(x = INCOME)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Income Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode and Median
cat("Income\n")
cat("Mode:", get_mode(df_clean$INCOME), "\n")

# Median (convert to numeric index and retrieve label)
income_numeric <- as.numeric(df_clean$INCOME)
income_levels <- levels(df_clean$INCOME)
income_median_label <- income_levels[median(income_numeric, na.rm = TRUE)]
cat("Median:", income_median_label, "\n")
```

**Conclusion**: The Income distribution is skewed to the left, with most subjects (or the mode) belonging to the income group of over 75 thousand dollars in income per year. When looking at the median that we calculated earlier, we can see that its results in 35-50k. This means that we have a lot more subjects that had a higher income value than other income groups.
<br><br>

**(e)** Predictor -- Race
```{r}
#table
table(df_clean$RACE)
prop.table(table(df_clean$RACE))

#Bar graph
ggplot(df_clean, aes(x = RACE)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Race Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Race\n")
cat("Mode:", get_mode(df_clean$RACE), "\n\n")
```

**Conclusion**: When looking at the predictor of Race, the distribution is highly imbalanced, with the mode of the data belonging to the race group of "White" (78.5% of the dataset). This distribution also tells us to be weary for the other parts of our study, as there isn't a proportionate distribution of all groups, which limits the results of our findings to other groups of the predictor.
<br><br>

**(f)** Predictor -- Age
```{r}
#table
table(df_clean$AGE)
prop.table(table(df_clean$AGE))

#Bar graph
ggplot(df_clean, aes(x = AGE)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Age Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode and Median
cat("AGE\n")
cat("Mode:", get_mode(df_clean$AGE), "\n")
median_index <- median(as.numeric(df_clean$AGE), na.rm = TRUE)
median_label <- levels(df_clean$AGE)[median_index]
cat("Median:", median_label, "\n\n")
```

**Conclusion**: This Age distribution is skewed to the left, with more participants at older ages, and it has a median of 55-59. This makes our results much more comprehensive for ages across our range.
<br><br>

#### 2) Correlation Analysis

In this section, for each predictor, we measure how the proportion of participants with heart attack changes across different categorical levels. This analysis provides an initial insight into the significance of each predictor; it also suggests the potential sign of coefficients in regression analysis on **HeartAttack**. 

```{r}
custom_colors <- c("No" = "#1a80bb", "Yes" = "#f2c45f")
```

**(a)** Heart Attack vs. BMI Categories
```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$BMI_Cat), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = BMI_Cat, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("BMI Level") +
  labs(fill = "Heart Attack Status") +
  scale_x_discrete(
    limits = c("Normal", "Overweight", "Obese"),
    labels = c(
      "Normal"      = "Normal Weight (18.5–24.9)",
      "Obese"       = "Obese (≥ 30.0)",
      "Overweight"  = "Overweight (25.0–29.9)"
    ),
    drop = TRUE
  ) +
  ggtitle("Proportion of Heart Attack by BMI Levels") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Conclusion**: We do see a difference in proportion of heart attacks across the different categories of BMI. Obese group is having the highest proportion of having heart attack followed by underweight. Normal group has the lowest proportion of having heart attack.
<br><br>

**(b)** Heart Attack vs. Sex
```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$SEX), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = SEX, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Sex") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Sex") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Conclusion**: Based on the proportion and bar graph, the proportion of males getting heart attack is higher than the proportion of females (0.078 vs. 0.042), suggesting males having higher risks of getting heart attack than females. 
<br><br>

**(c)** Heart Attack vs. Income Level
```{r}

#Table
prop.table(table(df_clean$HeartAttack, df_clean$INCOME), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = INCOME, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Income Level") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Income Level") +
  scale_fill_manual(values = custom_colors) +
  scale_x_discrete(limits = c("<$10k", "$10-15k", "$15-20k", "$20-25k", "$25-35k", "$35-50k", "$50-75k", ">=75k")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Conclusion**: Generally, the proportion of individuals having heart attack decreases as income level increases, suggesting a potential negative correlation between income level and odds of having heart attack. 
<br><br>

**(d)** Heart Attack vs. Race
```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$RACE), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = RACE, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Race") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Race") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Conclusion**: When looking at the bar plot we made, we do see a change in proportions of individuals having heart attack between the different categories of the Race predictor. Multiracial group is having the highest proportion of individuals with heart attack, and Hispanic group is having the lowest proportion of having heart attack.

**(e)** Heart Attack vs. Age
```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$AGE), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = AGE, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Age") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Age") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

**Conclusion**: Here we see a strong positive correlation between Age and the proportion of heart attacks. As the ages get higher and higher, so does the proportion of participants who noted that they did have a heart attack.
<br><br>

### IV. Methodology

  In this project, **HeartAttack** is selected as the response variable. Because it is a binary variable describing whether or not the respondent has heart attack (1=yes, 0=no), it will be logit transformed into logit (P(HeartAttack)). Logistic regression will be used for predicting odds of having heart attack.

  In the bar graphs, for each predictor, we visualize proportion of individuals with heart attack across different categories. Based on this preliminary analysis, we have observed correlations between 5 selected predictors with response variable **HeartAttack**. Significant predictors include **SEX**, **Income**, **AGE**,**Race**. Proportions of individuals with heart attack vary across different categorical levels, and it is observed in these predictors.  

  Specifically, we set **BMI** as the predictor in the main model. The significance of the predictor’s relationship with heart attack will be assessed using individual Z-tests. Other categorical factors will add as additive predictors in the extended model, which include **SEX**, **Income**, **Race**, and **Age**. Because they are categorical variables, we will analyze how the odds of having heart attack change when the category changes within each variable. Their overall contribution will first be evaluated using partial $\chi^2$ tests, and differences among levels of categorical predictors will be further examined through individual Z-tests. Only variables showing significant differences in heart attack odds across levels will be retained.
  
  Based on the significance results from both individual Z-tests and partial $\chi^2$ tests, the final extended model will be constructed. To ensure robustness, the final model will be assessed for influential data points using Cook’s distance and outlier tests for regression outliers. Multicollinearity between multiple predictors in the extensive models will be evaluated based on **Variance Inflation factor (VIF)**. The final model’s performance will be validated through goodness-of-fit measures: error rate test, which assess how well the model predicts the actual odds of heart attack.
<br><br>