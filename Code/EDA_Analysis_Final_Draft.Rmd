---
title: "EDA Notebook Analysis"
output: html_document
date: "2025-07-17"
Author: Yumeng Tan, Sherelle Li, Rom Zuckerman
---
### Heart Attack Exploratory Data Analysis

**Team Members**: Yumeng Tan, Sherelle Li, Rom Zuckerman

### I. Introduction

#### 1) Introducing the Dataset

  For this project, we work with data from the **2015 Behavioral Risk Factor Surveillance System (BRFSS)** -- a nationwide health survey run each year by the Centers for Disease Control and Prevention (CDC) in partnership with U.S. states and territories ([CDC](https://www.kaggle.com/datasets/cdc/behavioral-risk-factor-surveillance-system?select=2015.csv)). The survey is conducted through telephone interviews, both land-line and cellular, reaching adults aged 18 and older living in community settings.  

  The BRFSS is designed to monitor health-related risk behaviors, chronic conditions, and preventive care usage across the United States. In 2015, it collected responses from 441,456 individuals, covering all 50 states, the District of Columbia, Puerto Rico, and Guam. Its large, nationally representative sample offers a rich and reliable snapshot of health behaviors. With 330 variables, the dataset provides extensive opportunities for exploration and analysis.
  
  Beyond its size, the 2015 BRFSS has methodological advantages. First, the dataset is weighted to reflect state-level populations, making it a trusted source for public health planning, policy-making, and resource allocation. Second, more recent surveys have gaps in state participation—for example, the 2023 BRFSS excludes large states such as Pennsylvania and Kentucky—potentially reducing the reliability of national estimates. By contrast, the 2015 BRFSS offers complete state coverage, making it one of the most representative and comprehensive datasets for studying the U.S. population.
<br><br>

#### 2) Research Interest

  The original dataset contains 330 columns, making it difficult to track variables relevant to our research. Therefore, we subset the data to include only the variables necessary for our analysis.

  Our primary outcome of interest is `Heart Attack`. This choice is intentional: heart attacks are acute, life-threatening events that affect an estimated 17.9 million people worldwide each year ([NIH](https://www.nhlbi.nih.gov/health/heart-attack)) and require immediate medical attention. Moreover, they can occur even in individuals without a prior diagnosis of coronary heart disease ([Cleveland Clinic](https://my.clevelandclinic.org/health/diseases/16818-heart-attack-myocardial-infarction)). Therefore, identifying predictors is critical for preventing heart attack, making this outcome central to our study.
  
  Based on prior research, `Body Mass Index (BMI)` is a plausible predictor of heart attack risk and is selected as the main predictor in our model. Excess body fat has been linked to inflammation, insulin resistance, and arterial damage ([NIH](https://pmc.ncbi.nlm.nih.gov/articles/PMC8449192/). Moreover, BMI is the primary diagnostic metric for obesity -- a condition affecting 41.9% of U.S. adults ([CDC](https://www.cdc.gov/obesity/adult-obesity-facts/index.html)). Given obesity’s widespread prevalence and its cardiovascular implications, examining the relationship between BMI and heart attack risk has significant public health relevance.
  
  Because BMI’s effect on heart attack risk may be influenced by other factors, we also include four demographic variables -- `Sex`, `Race`, `Age`, and `Income` -- as covariates. These variables help control for potential confounding and allow us to assess interactions between BMI and demographic characteristics.
  
  In summary, our final dataset includes `Heart Attack` as the response variable, `BMI` as the primary predictor, and `Sex`, `Race`, `Age`, and `Income` as covariates. The original BRFSS dataset was subset accordingly for the analysis. With that in mind, let’s look at the specific variables that will guide our exploration.  

- `CVDINFR4`: Whether the respondent has ever been told they had a heart attack (myocardial infarction).  
  - 1 = Yes - 2 = No - 7 = Don’t know - 9 = Refused  

- `SEX`: Biological sex of the respondent.  
  - 1 = Male - 2 = Female  

- `INCOME2`: Annual household income from all sources, in categorical brackets.  
  - 1–8 = Ranges from < $10,000 to ≥ $75,000 - 77 = Don’t know - 99 = Refused  

- `X_RACEGR3`: Race group (recoded into 3 categories).  
  - 1 = White only - 2 = Black only - 3 = Other or multiracial  

- `X_AGEG5YR`: Age group in 5-year intervals.  
  - 1 = 18–24 - 2 = 25–29 - ... - 13 = 80+  

- `X_BMI5`: Body Mass Index (BMI), calculated as BMI × 100.  
  - Continuous variable: Divide by 100 to get actual BMI  

- `X_BMI5CAT`: BMI category based on X_BMI5.  
  - 1 = Underweight - 2 = Normal weight - 3 = Overweight - 4 = Obese  

  Taken together, these variables give us a comprehensive prediction on heart attack risks. The next step in our exploration will be preparing and transforming the data so we can uncover these relationships in a clear, systematic way.
<br><br>

### II. Dataset Manipulation

#### 1) Loading dataset and packages

1. **Install and load packages**: We set up the environment and install the packages necessary for our data analysis below. In the code below, we load all the installed packages to make the functions within them available to use in our script.

```{r}
# Load libraries
library(ggplot2)
library(car)
library(carData)
library(ResourceSelection)
library(pROC)
library(dplyr)
library(emmeans)
library(ggeffects)
```
<br><br>

2. **Loading Dataset**: We first load our original dataset **2015.csv** into R Studio as data frame **df**, and we shows the first 6 observations of the dataset using the function head(). 

```{r}
#Load original dataset
df <- read.csv("~/Documents/GitHub/EDA_Project/data/2015.csv")
head(df)
```
<br><br>

3. **Selecting relevant variables**: The original dataset, `df`, contains 330 variables. To create a more concise and analysis-ready dataset, we subset it to include only the variables required for our study. These include the response variable **heart attack** (`CVDINFR4`) and the predictors **sex** (`SEX`), **income level** (`INCOME2`), **race** (`X_RACEGR3`), **age** (`X_AGE80` for numeric; `X_AGEG5YR` for categorical), and **BMI** (`X_BMI5` for numeric; `X_BMI5CAT` for categorical). The subsetted dataset is stored as a new data frame, `df1`.

```{r}
#Select relevant predictors and dependent variable
df1 <- df[, c("CVDINFR4", "SEX", "INCOME2", "X_RACEGR3", "X_AGEG5YR", "X_AGE80", "X_BMI5",
              "X_BMI5CAT")]
```
<br><br>

#### 2) Factoring and Renaming Variables 

After selecting the response variable and main predictors, we redefine our variables in three steps: **factor variables**, **rename variables**, and **detect NA values**.

-- **Factor variables**: In the original dataset, all variables are coded as numbers, even when they represent categories. We convert these numeric codes to their corresponding categorical labels using the `factor()` function.  

-- **Rename variables**: For clarity, we store the factored variables under more descriptive names.  

-- **Detect NA values**: In the BRFSS dataset, missing values are encoded as specific numeric codes for each variable (as documented in the 2015 BRFSS codebook available on the CDC website). We identify these codes for each variable and recode them to `NA` using the `factor()` function.

<br><br>

**(a)** Response Variable -- HeartAttack

Our response variable, **Heart Attack**, is stored as `CVDINFR4` in the original dataset and contains four categories:  `1 = No`, `2 = Yes`, `7 = Don't know`, and `9 = Refused`.  We convert the numeric codes into descriptive labels using the `factor()` function. Specifically, we recode `1` and `2` as `"No"` and `"Yes"`, and treat `7` and `9` as missing values (`NA`). The cleaned and relabeled variable is stored as `HeartAttack`.

```{r}
# Recode CVDINFR4
df1$CVDINFR4[df1$CVDINFR4 %in% c(7, 9)] <- NA
df1$HeartAttack <- factor(df1$HeartAttack, levels = c(1, 2), labels = c("No", "Yes"))
```
<br><br>

**(b)** Main Predictor -- Body Mass Index

Our main predictor, **Body Mass Index (BMI)**, is stored as `X_BMI5` in the original dataset and is a numeric variable, so no factor conversion is required. In this variable, a value of `9999` indicates “Don’t know/Refused/Missing,” which we recode as `NA`. We then store the cleaned values in a new variable, `BMI_Num`. Because BMI values in the original dataset are multiplied by 100, we divide them by 100 to obtain the actual BMI values.

```{r}
# Recode _BMI5 
df1$`X_BMI5`[df1$`X_BMI5` == 9999] <- NA
names(df1)[names(df1) == "X_BMI5"] <- "BMI_Num"
df1$BMI_Num <- df1$BMI_Num / 100
```
<br><br>

While BMI as a numeric variable is used in the regression model, BMI as a categorical variable with four categories is used in the EDA analysis and bar graphs. In the original dataset, this variable is stored as `X_BMI5CAT` and contains four categories: `1 = Underweight`, `2 = Normal`, `3 = Overweight`, and `4 = Obese`. We convert the numeric codes to descriptive labels using the `factor()` function and store the relabeled variable in a new variable, `BMI_Cat`.

```{r}
# Recode _BMI5CAT
df1$BMI_Cat <- factor(df1$`X_BMI5CAT`, levels = 1:4,
                         labels = c("Underweight", "Normal", "Overweight", "Obese"))
```
<br><br>

**(c)** Demographic Predictor -- Sex

The first demographic predictor, **Sex**, is stored as `SEX` in the original dataset and contains two categories: `1 = Male` and `2 = Female`.We convert the numeric codes to descriptive labels using the `factor()` function and store the relabeled variable in a new variable, `SEX`.

```{r}
# Recode SEX
df1$SEX <- factor(df1$SEX, levels = c(1, 2), labels = c("Male", "Female"))
```
<br><br>

**(d)** Demographic Predictor -- Income

The second demographic predictor, **Income**, is stored as `INCOME2` in the original dataset and contains nine categories: `1 = <$10k`, `2 = $10–15k`, `3 = $15–20k`, `4 = $20–25k`, `5 = $25–35k`, `6 = $35–50k`, `7 = $50–75k`, `8 = ≥$75k`, and `77` or `99` = *Don't know / Not sure / Missing*. We convert the numeric codes into descriptive labels using the `factor()` function and recode `77` and `99` as `NA`. The cleaned variable is stored as `INCOME`.

```{r}
# Recode INCOME2
df1$INCOME2[df1$INCOME2 %in% c(77, 99)] <- NA
df1$INCOME <- factor(df1$INCOME2, levels = c(1:8),
                      labels = c("<$10k", "$10-15k", "$15-20k", "$20-25k", "$25-35k",
                                 "$35-50k", "$50-75k", ">=75k"))
```
<br><br>

**(e)** Demographic Predictor -- Race

The third demographic predictor, **Race**, is stored as `X_RACEGR3` in the original dataset and contains six categories: `1 = White`, `2 = Black`, `3 = Other`, `4 = Multiracial`, `5 = Hispanic`, and `9 = Don't know / Not sure / Missing`. We convert the numeric codes into descriptive labels using the `factor()` function and recode `9` as `NA`. The cleaned variable is stored as `RACE`.

```{r}
# Recode _RACEGR3 as factor with appropriate labels
df1$`X_RACEGR3`[df1$`X_RACEGR3` == 9] <- NA
df1$RACE <- factor(df1$`X_RACEGR3`,
                         levels = c(1:5),
                         labels = c("White", "Black", "Other",
                                    "Multiracial", "Hispanic"))
```
<br><br>

**(f)** Demographic Predictor -- Age

The fourth demographic predictor, **Age**, is stored as `X_AGE80` in the original dataset and is a numeric discrete variable representing age in years (capped at 80). We store this variable as `AGE_Num` for clarity.

```{r}
# Recode _AGE80 
names(df1)[names(df1) == "X_AGE80"] <- "AGE_Num"
```
<br><br>

While age as a numeric variable is used in the regression model, age as a categorical variable with 13 categories is used in the EDA analysis and bar graphs. In the original dataset, this variable is stored as `X_AGEG5YR` and contains 13 ordered categories. We convert the numeric codes into descriptive labels using the `factor()` function and store the relabeled variable as `AGE`.

```{r}
# Recode _AGEG5YR
df1$AGE <- factor(df1$`X_AGEG5YR`, levels = 1:13,
                         labels = c("18–24", "25–29", "30–34", "35–39", "40–44", "45–49",
                                    "50–54", "55–59", "60–64", "65–69", "70–74", "75–79", "80+"))
```
<br><br>

#### 3) Handling Missing Values

After renaming and factoring the relevant variables and defining `NA` values, the next step is to remove any rows with missing data. We use the `na.omit()` function to delete rows containing `NA` values from the dataset. The cleaned dataset is stored as `df_clean` and exported as a CSV file for future use with the `write.csv()` function.

```{r}
# Remove rows with any NA values
df_clean <- na.omit(df1)  

#save cleaned files into csv
write.csv(df_clean, "~/Documents/GitHub/EDA_Project/data/cleaned_data.csv", row.names = FALSE)
```
<br><br>

#### 4) Importing Cleanded Dataset

The final cleanded dataset is imported into R for future analysis using read.csv(). The dataset is stored as a new data frame `df_clean`.

```{r}
df_clean <- read.csv("~/Documents/GitHub/EDA_Project/data/cleaned_data.csv")
```


### III. Data Visualization and Tendency Measurement

#### 1) Frequency Distribution of Heart Attack and Predictors

**Visualization**: After obtaining the cleaned dataset, we visualize the distribution of the response variable **HeartAttack** and the five predictors. We also measure the central tendency using the mode, median, or mean, depending on whether the variable is categorical, ordinal, or numeric. For distribution statistics, we first calculate the frequency of observations within each category using `table()`, then convert frequencies to proportions using `prop.table()`. For visualization, we create bar graphs showing the proportion of observations in each category using the `ggplot()` function.  
<br><br>

**Define Mode Function for Central Tendency Measurement**:  
We define a custom function `get_mode()` to calculate the mode, which will be used later for central tendency measurement. The function takes a vector as input, generates a frequency table, and returns the value with the highest frequency.

```{r}
# Function to calculate mode
get_mode <- function(v) {
  tbl <- table(v)
  mode_val <- names(tbl)[which.max(tbl)]
  return(mode_val)
}
```
<br><br>

**(a)** Response Variable -- HeartAttack

Distribution is calculated and visualized as described above. For central tendency measurement, we calculate mode of the variable since it is categorical.

```{r}
#table
table(df_clean$HeartAttack)
prop.table(table(df_clean$HeartAttack))

#Bar graph
ggplot(df_clean, aes(x = HeartAttack)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of HeartAttack Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Head_Attack\n")
cat("Mode:", get_mode(df_clean$HeartAttack), "\n\n")
```

**Interpretation**: Based on the mode calculation, No is dominantly observed over Yes, meaning more people who filled out the questionnaire doesn’t have heart attack. However, there is still a sufficient amount of observations having heart attack, with an occurrence of 18,674, which is about 5.85% of the total sample size.
<br><br>

**(b)** Predictor -- BMI

For distribution statistics and visualization, we use the categorical version of BMI (`BMI_Cat`). When using the numeric version (`BMI_Num`), the proportion is calculated for each distinct numeric value, which can make the plot difficult to interpret and may not reveal meaningful variation. In contrast, the categorical version provides a clearer view of how the distribution varies across the main BMI categories. 

For central tendency measurement, we use the numeric version (`BMI_Num`) to obtain more detailed statistics. Specifically, we calculate the **mode**, **median**, and **mean** of BMI to better understand its central distribution.

```{r}
#table
table(df_clean$BMI_Cat)
prop.table(table(df_clean$BMI_Cat))

#Bar graph
ggplot(df_clean, aes(x = BMI_Cat)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of BMI Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode and Median and Mean
cat("BMI_Num\n")
cat("Mode:", get_mode(df_clean$BMI_Num), "\n")
cat("Median:", median(df_clean$BMI_Num, na.rm = TRUE), "\n")
cat("Mean:", mean(df_clean$BMI_Num, na.rm = TRUE), "\n\n")
```

**Interpretation**: We find that this distribution is skewed to the right, with a large tail that stretches towards the higher BMI values. This means that we have a very comprehensive distribution for the lower BMI values, but due to the large tail and few values at the higher end of range, our statistics such as mean (2820.969) and median (2712) are being skewed to the right. 
<br><br>

**(c)** Predictor -- Sex

Distribution is calculated and visualized as described above. For central tendency measurement, we calculate mode of the variable since it is categorical.

```{r}
#table
table(df_clean$SEX)
prop.table(table(df_clean$SEX))

#Bar graph
ggplot(df_clean, aes(x = SEX)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Sex Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Sex\n")
cat("Mode:", get_mode(df_clean$SEX), "\n\n")
```

**Interpretation**:  Based on the mode calculation, female is dominantly observed over male (54.99% vs. 45.01%). This is something notable to consider when looking at other results from distributions and linear regression, as the subject's sex isn't evenly distributed, rather leaning more towards a higher count of female participants than of the male sex.
<br><br>

**(d)** Predictor -- Income

Distribution is calculated and visualized as described above. For central tendency measurement, we calculate mode of the variable since it is categorical. 

```{r}
#table
table(df_clean$INCOME)
prop.table(table(df_clean$INCOME))

#Bar graph
ggplot(df_clean, aes(x = INCOME)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Income Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Income\n")
cat("Mode:", get_mode(df_clean$INCOME), "\n")
```

**Interpretation**: The Income distribution is skewed to the left, with most subjects (or the mode) belonging to the income group of over 75 thousand dollars in income per year. This means that we have a lot more subjects that had a higher income value than other income groups.
<br><br>

**(e)** Predictor -- Race

Distribution is calculated and visualized as described above. For central tendency measurement, we calculate mode of the variable since it is categorical. 

```{r}
#table
table(df_clean$RACE)
prop.table(table(df_clean$RACE))

#Bar graph
ggplot(df_clean, aes(x = RACE)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Race Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode
cat("Race\n")
cat("Mode:", get_mode(df_clean$RACE), "\n\n")
```

**Interpretation**: When looking at the predictor of Race, the distribution is highly imbalanced, with the mode of the data belonging to the race group of "White" (78.5% of the dataset). This distribution also tells us to be weary for the other parts of our study, as there isn't a proportionate distribution of all groups, which limits the results of our findings to other groups of the predictor.
<br><br>

**(f)** Predictor -- Age

For distribution statistics and visualization, we use the categorical version of Age (`AGE`). When using the numeric version (`AGE_Num`), the proportion is calculated for each distinct numeric value, which can make the plot difficult to interpret and may not reveal meaningful variation. In contrast, the categorical version provides a clearer view of how the distribution varies across the main age groups.  

For central tendency measurement, we use the numeric version (`AGE_Num`) to obtain more detailed statistics. Specifically, we calculate the **mode**, **median**, and **mean** of Age to better understand its central distribution.

```{r}
#table
table(df_clean$AGE)
prop.table(table(df_clean$AGE))

#Bar graph
ggplot(df_clean, aes(x = AGE)) +
  geom_bar(fill = "#1a80bb", color = "black") +
  ggtitle("Bar Plot of Age Distribution") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

#Central Tendency -- Mode and Median
cat("AGE_Num\n")
cat("Mode:", get_mode(df_clean$AGE_Num), "\n")
cat("Median:", median(df_clean$AGE_Num, na.rm = TRUE), "\n")
cat("Mean:", mean(df_clean$AGE_Num, na.rm = TRUE), "\n\n")
```

**Interpretation**: This Age distribution is skewed to the left, with more participants at older ages, and it has a median of 55-59. This makes our results much more comprehensive for ages across our range.
<br><br>

#### 2) Correlation Analysis

Moving beyond visualizing distribution, for each predictor, we examine how the proportion of participants with **HeartAttack** varies across different categorical levels. This analysis provides an initial insight into the potential significance of each predictor and hints at the possible sign of the coefficients in a regression analysis on **HeartAttack**.  

For distribution statistics, we calculate the proportion of individuals with heart attack within each category of the predictor using the `prop.table()` function. For visualization, we use bar graphs created with `ggplot()` to display the proportion of participants with heart attack in each category.
<br><br>

We first define the main theme color for the future bar graphs
```{r}
custom_colors <- c("No" = "#1a80bb", "Yes" = "#f2c45f")
```
<br><br>

**(a)** Heart Attack vs. BMI Categories

For distribution statistics and visualization of **HeartAttack** across BMI levels, we use the categorical version of BMI (`BMI_Cat`). When using the numeric version (`BMI_Num`), the proportion is calculated for each distinct numeric value, which can make the results difficult to interpret and may not reveal meaningful variation. In contrast, the categorical version provides a clearer view of how the distribution of heart attack cases varies across the main BMI categories.

```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$BMI_Cat), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = BMI_Cat, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("BMI Level") +
  labs(fill = "Heart Attack Status") +
  scale_x_discrete(
    limits = c("Normal", "Overweight", "Obese"),
    labels = c(
      "Normal"      = "Normal Weight (18.5–24.9)",
      "Obese"       = "Obese (≥ 30.0)",
      "Overweight"  = "Overweight (25.0–29.9)"
    ),
    drop = TRUE
  ) +
  ggtitle("Proportion of Heart Attack by BMI Levels") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br><br>

**(b)** Heart Attack vs. Sex

Distribution of heart attack across sex groups is calculated and visualized as described above.

```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$SEX), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = SEX, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Sex") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Sex") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br><br>

**(c)** Heart Attack vs. Income Level

Distribution of heart attack across income levels is calculated and visualized as described above.

```{r}

#Table
prop.table(table(df_clean$HeartAttack, df_clean$INCOME), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = INCOME, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Income Level") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Income Level") +
  scale_fill_manual(values = custom_colors) +
  scale_x_discrete(limits = c("<$10k", "$10-15k", "$15-20k", "$20-25k", "$25-35k", "$35-50k", "$50-75k", ">=75k")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br><br>

**(d)** Heart Attack vs. Race

Distribution of heart attack across race groups is calculated and visualized as described above.

```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$RACE), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = RACE, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Race") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Race") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br><br>

**(e)** Heart Attack vs. Age

For distribution statistics and visualization of **HeartAttack** across age groups, we use the categorical version of Age (`AGE`). When using the numeric version (`AGE_Num`), the proportion is calculated for each distinct numeric value, which can make the results difficult to interpret and may not reveal meaningful variation. In contrast, the categorical version provides a clearer view of how the distribution of heart attack cases varies across the main age categories.

```{r}
#Table
prop.table(table(df_clean$HeartAttack, df_clean$AGE), margin = 2)

#Bar graph
ggplot(df_clean, aes(x = AGE, fill = HeartAttack)) +
  geom_bar(position = "fill") +
  ylab("Proportion") +
  xlab("Age") +
  labs(fill = "Heart Attack Status") +
  ggtitle("Proportion of Heart Attack by Age") +
  scale_fill_manual(values = custom_colors) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
<br><br>

**(f)** Conclusion

  Based on the correlation analysis, a positive association is observed between the main predictor **BMI** and heart attack risk. When BMI increases from the normal group (18.5–24.9) to the obese group (≥30.0), the percentage of individuals with heart attack rises from **4.3%** to **7.2%**, suggesting BMI is a potential predictor of heart attack risk.  

  Beyond BMI, the proportion of individuals with heart attack also varies across all demographic variables, indicating that these variables may act as confounders and should be controlled in the regression model.  

- **Sex**: The proportion of heart attack cases is higher among males (**7.8%**) than females (**4.2%**), suggesting higher risk for males.  

- **Age**: There is a strong positive correlation between age and heart attack proportion—risk increases with age.

- **Income**: The proportion decreases as income level increases, suggesting a potential negative correlation between income and heart attack risk.  

- **Race**: The multiracial group has the highest proportion of individuals with heart attack, while the Hispanic group has the lowest proportion.
<br><br>

### IV. Next Step

  In this project,  **HeartAttack** is selected as the response variable. Because it is a binary variable describing whether or not the respondent has heart attack (1=yes, 0=no), it will be logit transformed into logit (P(HeartAttack)). Logistic regression will be used for predicting odds of having heart attack.

  In the bar graphs, for each predictor, we visualize proportion of individuals with heart attack across different categories. Based on this preliminary analysis, we have observed correlations between 5 selected predictors with response variable **HeartAttack**. Significant predictors include **SEX**, **Income**, **AGE**,**Race**. Proportions of individuals with heart attack vary across different categorical levels, and it is observed in these predictors.  

  Specifically, we set **BMI** as the predictor in the main model. The significance of the predictor’s relationship with heart attack will be assessed using individual Z-tests. Other categorical factors will add as additive predictors in the extended model, which include **SEX**, **Income**, **Race**, and **Age**. Because they are categorical variables, we will analyze how the odds of having heart attack change when the category changes within each variable. Their overall contribution will first be evaluated using partial $\chi^2$ tests, and differences among levels of categorical predictors will be further examined through individual Z-tests. Only variables showing significant differences in heart attack odds across levels will be retained.
  
  Based on the significance results from both individual Z-tests and partial $\chi^2$ tests, the final extended model will be constructed. To ensure robustness, the final model will be assessed for influential data points using Cook’s distance and outlier tests for regression outliers. Multicollinearity between multiple predictors in the extensive models will be evaluated based on **Variance Inflation factor (VIF)**. The final model’s performance will be validated through goodness-of-fit measures: error rate test, which assess how well the model predicts the actual odds of heart attack.
<br><br>